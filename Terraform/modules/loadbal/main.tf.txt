resource "google_compute_global_forwarding_rule" "global_forwarding_rule" {
  name       = var.fwd-rule-name
  project    = var.project_id
  target     =  google_compute_target_http_proxy.target_http_proxy.self_link
  port_range = "80"
}


resource "google_compute_target_http_proxy" "target_http_proxy" {
  name    = var.proxy-name
  project = var.project_id
  url_map = google_compute_url_map.url_map.self_link
}

resource "google_compute_url_map" "url_map" {
  name            = var.url-name
  project         = var.project_id
  default_service = google_compute_backend_service.backend_service.self_link
}

resource "google_compute_health_check" "healthcheck" {
  name               = var.healthcheck-name
  timeout_sec        = 5
  check_interval_sec = 10
  http_health_check {
    port = 80
  }
}

resource "google_compute_backend_service" "backend_service" {
  name                    = var.backend-service-name
  project                 = var.project_id
  port_name               = "http"
  protocol                = "HTTP"
  health_checks           = [google_compute_health_check.healthcheck.id]

  backend {
    group                 = var.instance-grp-name    
  }
}
